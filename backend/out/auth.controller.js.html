<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: auth.controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: auth.controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const passport = require('passport')
const { signToken } = require('../config/token.config')

/**
 * SignIn route verify user authentication. Return error message if user doesn't exist. Generate token, 
 * and return token with user datas object if user exist.
 * @module signIn
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @return {undefined}
 */

exports.signIn = (req, res) => {
  passport.authenticate('local', { session: false }, (err, user, info) => {
    try {
      if (err) {
        res.status(500)
      }
      if (!user) {
        return res.status(400).json({ message: info.message })
      }
      if (user) {
        const { _id } = user
        const token = signToken(_id)
        res.status(200).json({ isAuthenticated: true, user, token })
      }
    } catch (error) {
      throw error
    }
  }
  )(req, res)
}

/**
 * SignOut route allows sign out user in frontend. If not error, 
 * return object with empty user data and isAuthenticated false.
 * @module signOut
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Object} err - Express error object
 * @return {undefined}
 */

exports.signOut = (req, res, err) => {
  try {
    if (err) {
      res.status(500)
    }
    res.status(200).json({ user: { username: '' }, isAuthenticated: false, success: true })
  } catch (error) {
    throw error
  }
}

/**
 * verifyAuth verify if user exist in database, and if user token coming from front-end 
 * matches with backend. If not matches, return object with empty user, false boolean for 
 * isAuthenticated and error message.
 * If matches, return object with true boolean for isAuthenticated and user datas.
 * @module verifyAuth
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @return {undefined}
 */

exports.verifyAuth = (req, res) => {
  passport.authenticate('jwt', { session: false }, (err, user) => {
    try {
      if (err) {
        res.status(500)
      }
      if (!user) {
        return res.json({ isAuthenticated: false, user: { username: '' }, message: 'Utilisateur introuvable.' })
      }
      res.status(200).json({ isAuthenticated: true, user })
    } catch (error) {
      throw error
    }
  })(req, res)
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#signIn">signIn</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#verifyAuth">verifyAuth</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Fri Jul 31 2020 12:01:11 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
